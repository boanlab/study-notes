# Transport layer
- TCP/IP 에서 TCP와 UDP라는 2개의 대표적인 트랜스포트 프로토콜이 존재한다. TCP는 신뢰성 있는 통신을 제공하고, UDP는 동보 통신이나 세세한 제어는 애플리케이션에게 맡기는 편이 좋은 통신에 사용된다. 즉, 필요로 하는 통신의 특성에 따라 사용할 트랜스퐅 프로토콜을 선택할 수 있다.
## 트랜스포트층이란
- OSI 참조 모델의 4층에 해당하는 트랜스포트층에 포트 번호에 의해 트랜스포트층의 상위층인 애플리케이션층의 처리를 수행할 프로그램을 식별한다.
## 통신 처리
- 트랜스포트 프로토콜인 TCP, UDP는 포트 번호를 바탕으로 수신한 데이터가 누구 앞으로 온 것인지 판단한다.
## TCP와 UDP
### TCP
- TCP는 커넥션 지향의 신뢰성 있는 스트림형 프로토콜이다.
- 애플리케이션이 TCP를 사용하여 메시지를 송신하면, 송신한 순서는 유지되지만 하나로 이어진 데이터 구조로 수신 측의 애플리케이션에게 전달된다.
### UDP
- UDP는 신뢰성 없는 데이터그램형 프로토콜이다.
- 세세한 처리는 애플리케이션이 담당한다.
- UDP의 경우 송신할 때에 메시지의 크기가 유지되지만, 패킷이 반드시 도달한다는 보장이 없다.
- 필요에 따라 애플리케이션의 메시지 재전송 처리가 필요하다.
## TCP vs UDP
<img width="600" alt="image" src="https://user-images.githubusercontent.com/110087065/210268931-c57e5b29-05e8-4c99-9ec1-404d7f48cb6c.png">


# 포트 번호
## 포트 번호란
- 트랜스포트 프로토콜에는 '포트 번호'가 존재한다.
- 포트 번호는 동일한 컴퓨터 안에서 통신을 하고 있는 프로그램을 식별할 때에 사용된다. 즉, 프로그램의 주소라고 할 수 있다.
## 포트 번호의 결정 방법
- 통신을 하기 전에 포트 번호를 결정해야 하는데 포트 번호를 결정하는 방법은 두 가지가 존재한다.
### 1. 표준으로 정해져 있는 번호
- 사용 목적이 정해져 있는 포트 번호를 고정적으로 사용하는 방법이다.
- 널리 사용되는 애플리케이션 프로토콜에는 사용할 포트가 정해져 있는데 이를 잘 알려진 포트 번호(Well-known Port Number)라고 한다.
- 잘 알려진 포트 번호는 0~1023까지의 번호가 할당되어 있다. 이 번호들은 다른 용도로 사용하지 않는 것이 좋다.
- '정식으로 등록된 포트 번호'도 존재하는데 1024~49151까지의 번호로 할당 되어 있다. 이 번호들은 다른 용도로 사용해도 혼란을 야기하지 않는다.
### 2. 동적 할당법
- 서버는 포트 번호가 정해져 있지만, 클라이언트는 포트 번호가 정해져 있지 않아도 된다.
- 운영체제에게 포트 번호 결정을 일임하여 운영체제가 동적으로 포트 번호를 관리한다.
- 운영체제는 애플리케이션별로 동일한 값이 되지 않도록 제어하면서 포트 번호를 할당한다.
- 동적으로 할당하는 포트 번호는 49152~65535까지의 번호를 사용한다.
## 포트 번호와 프로토콜
- 포트 번호는 사용하는 트랜스포트 프로토콜별로 결정되기 때문에 다른 프랜스포트 프로토콜의 경우 동일한 포트 번호를 사용할 수 있다.
- 동일한 포트 번호가 오더라도 트랜스포트별로 TCP는 TCP 모듈이 UDP는 UDP 모듈이 포트번호를 처리하기 때문에 같으 포트번호를 사용할 수 있다.

# UDP(User Datagram Protocol)
## UDP의 목적과 특징
- UDP는 복잡한 제어를 제공하지 않고, IP를 사용하여 Connectionless 통신 서비스를 제공한다.
- UDP는 네트워크가 복잡해도 송신량을 제어하고 혼잡을 회피하는 통신을 하지 않는다.
- 패킷이 분실되어도 재전송 처리를 하지 않고, 패킷의 도착 순서가 변동되었을 때 고치는 기능이 없다.
- 이러한 제어가 필요할 때는 애플리케이션 프로그램에서 처리해야 한다.
- UDP는 Connectionless이기 때문에 언제든지 데이터를 송신할 수 있고 UDP 프로토콜 자체의 처리도 간단하여 고속 작동하므로 아래와 같은 용도에 적합하다.
  - 총 패킷 수가 적은 통신(DNS, SNMP)
  - 멀티미디어 통신
  - LAN과 같은 네트워크가 한정된 애플리케이션 통신
  - Broadcast, Multicast


# TCP(Transmission Control Protocol)
- TCP는 전송, 송신, 통신을 제어하는 프로토콜이다.
- 패킷이 분실된 경우 재전송 처리를 하고, 순서가 바뀐 경우의 순서 제어를 한다.
- 커넥션 제어가 존재하여 통신 상대가 있는 경우에만 데이터를 송신하여 쓸데없는 통신을 제어할 수 있다.
## TCP의 목적과 특징
- IP 데이터그램을 사용하여 신뢰성 있는 통신을 실현하기 위해 고안되었다.
- TCP에서는 체크섬이나 시퀀스 번호, 확인 응답, 재전소 제어, 커넥셔 관리, 윈도 제어와 같은 기능을 제공하여 신뢰성 있느 통신을 실현시킨다.
## 시퀀스 번호와 확인 응답으로 신뢰성을 제공
- TCP에서 송신한 데이터가 수신 호스트에 도착하면 수신 호스트는 송신 호스트에게 데이터가 도착했다는 '확인 응답'(ACK)를 보낸다.
## 재전송 타임아웃의 결정
- 재전송하지 않고 ACK를 기다리는 시간을 재전송 타임아웃 시간이라고 한다.
- 재전송 타임아웃 시간이 경과해도 ACK가 도착하지 않은 경우 데이터를 재전송한다.
- 재전송 타임아웃 시간의 이상적인 시간은 '이 시간이 경과하며 ACK가 돌아오지 않는다'의 최소 시간이다.
- TCP에서는 네트워크의 혼잡변화에도 동적으로 대응할 수 있도록 라운드 트립 시간(RTT)과 분산을 측정하고 라운드 트립 시간과 분산 시간을 합한 값보다 조금 큰 값을 재전송 타임아웃 시간으로 설정한다.
## 커넥션 관리
- 커넥션 지향에서는 데이터 통신을 시작하기 전에 통신 상대와 통신을 시작할 준비가 필요하다.
- TCP는 데이터 통신 전에 TCP 헤더만으로 된 커넥션 확립 요청 패킷(SYN 패킷)을 송신하여 응답을 기다리고, 수신자에게 확인 응답을 받으면 데이터 통신이 가능하다.
## TCP는 세그먼트 단위 데이터를 전송
- TCP는 커넥션 확립 시에 통신을 수행할 데이터의 단위를 결정하는데, 이를 '최대 세그먼트 길이'(MSS)라고 한다.
- 이상적인 최대 세그먼트 길이는 IP에서 분할 처리되지 않는 최대 데이터 길이이다.
- 대량의 데이터를 송신할 때 MSS값별로 데이터를 구분하여 송신하고, 재전송 처리도 MSS 단위로 수행된다.
## 윈도 제어로 속도 향상
- TCP는 윈도 제어를 도입하여 패킷의 왕복 시간이 길어져도 성능이 저하되지 않도록 제어한다.
- 세그먼트 단위가 아닌 더 큰 단위로 확인 응답을 처리하면, 전송 시간이 큰 폭으로 단축된다. 이는 송신한 세그먼트에 대해 확인 응답을 기다리지 않고 여러 개의 세그먼트를 송심함으로써 실현된다.
- 확인 응답을 기다리지 않고 송신할 수 있는 데이터 크기를 '윈도 사이즈'라고 한다.
- 송신할 데이터의 일부분만을 볼 수 있도록 한 창이 '윈도'이다.
- 창에서 보이는 데이터 부분은 확인 응답을 수신하지 않아도 송신 가능하다.
- 창 바깥쪽의 보이지 않는 부분은 송신해서는 안되는 부분이거나 이미 상대방에게 도착한 부분이다.
## 윈도 제어와 재전송 제어
- 윈도 제어를 하는 경우에는 확인 응답이 분실되어도 재전송할 필요가 없다.
- 수신 호스트에서는 다음에 수신해야 할 시퀀스 번호 이외의 데이터를 받은 경우 수신한 데이터에 대한 확인 응답을 반환한다.
- 윈도가 클 때 데이터가 분실되면 동일한 번호로 된 확인 응답을 연속 반환하는데, 송신 호스트가 동일한 확인 응답을 연속해서 세 번 수신하면 해당 확인 응답이 가리키고 있는 데이터를 재전송한다. 이를 '고속 재전송 처리'라고 한다.
## 플로 제어(유량 제어)
- 네트워크 부하가 높을 때 데이터를 모두 수신하지 못할 수 있는 상황을 방지하기 위해 TCP의 송신측은 수신 측의 상황에 맞추어 데이터 송신량을 제어하는 것을 '플로 제어'라고 한다.
- 송신 호스트가 수신 호스트에게 수신 가능한 데이터 크기를 통지하여 크기를 넘지 않는 데이터를 보내는데 이 크기가 '윈도 사이즈'이다.
- 수신 측 버퍼가 가득 찬다면 윈도의 값을 작게 설정하여 송신 호스트에게 전달함으로써 데이터 송신량을 제어한다.
## 혼잡 제어(네트워크 혼잡 해소)
- 혼잡한 네트워크에 대량의 데이터를 전송하면 제3자에게 피해를 줄 수 있기 때문에 이를 방지하기 위해 슬로 스타트라는 알고리즘에 따라 데이터의 송신량을 제어한다.
- 슬로 스타트를 할 때 송신 측에서 데이터의 송신량을 조절하기 위한 '혼잡 윈도'의 크기를 1세그먼트로 설정하여 데이터 패킷을 전송하고, 그에 대한 확인 응답을 받을 때마다 혼잡 윈도를 1세그먼트 씩 증가한다.
- 혼잡 윈도와 상대방 호스트로부터 통지된 윈도를 비교하여 작은 쪽의 값 이하가 되도록 데이터 패킷으 송신한다.
## 네트워크의 이용 효율을 높이는 장치
### Nagle 알고리즘
- Nagle 알고리즘은 송신 측이 송신해야 할 데이터가 있더라도 데이터가 적은 경우 송신을 늦추는 처리이다.
- '모든 송신 완료 데이터가 확인 응답된 경우', '최대 세그먼트 길이의 데이터를 송신할 수 있는 경우' 중 하나에 해당하는 경우에만 데이터 세그먼트를 송신하고, 둘다 해당되지 않을 경우 데이터 송신을 늦춘다.
### 지연 확인 응답
- 
### Piggyback
- 
## TCP를 이용하는 애플리케이션
### UDP-Lite
### SCTP
### DCCP

# 기타 트랜스포트 프로토콜
## UDP-Lite
## SCTP
## DCCP
