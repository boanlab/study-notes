# 관계 데이터 베이스
## 관계 데이터 모델
- 1970년에 IBM의 E.F.Codd에 의해 제안됨
- 특성
    - `테이블 형태`의 집합의 개념으로 직관적인 이해가 쉬움
    - 테이블 = 관계(relation) - 첫 행은 릴레이션 스키마, 나머지 행은 릴레이션 인스턴스로 나뉨
    - 열 = 속성(attribute)
    - 행 = 튜플(tuple)
    - 도메인 : 속성이 가질 수 있는 값들의 집합
        - ex) 속성이 성별일때 도메인은 남,여
    - 차수(Degree) : 속성의 개수(최소 한개 이상을 가져야함)
    - 카디널리티 : 튜플의 수
- 릴레이션 스키마
    - 릴레이션 내포 또는 릴레이션 스킴 이라고도 함
    - 릴레이션 이름 + 속성 이름 R($A_1,A_2,...,A_n$)
    - 정적 성질 : `시간에 무관`
- 릴레이션 인스턴스
    - 릴레이션 외면 이라고도 함
    - 어느 시점에 릴레이션이 포함하고 있는 튜플의 집합 {<$V_1, V_2, ..., V_n$>}
    - 동적 성질 : 삽입, 삭제 갱신 등으로 시점에 따라 `값이 다름`    
---
### 릴레이션
- 수학적 정의 : 카디션 프로덕트(발생가능한 모든 경우의 수의 행이 출력되는 것)의 부분집합
- 특성
    1. 튜플의 유일성
        -  릴레이션 = 튜플들의 `집합`(집합은 중복을 허용 X)
    2. 튜플의 무순서성
        - 튜플 사이에는 `순서가 없다`.
    3. 속성의 무순서성
        - 속성 사이에는 `순서가 없다`.
    4. 속성의 원자성
        - 속성값은 논리적으로 더 이상 분해할 수 없는 `원자값`임
        - 정규화 릴레이션
            - 속성값이 원자값으로만 구성된 릴레이션
        - 널 값도 원자값으로 취급
- 관계 데이터베이스
    - 테이블들의 집합
- 관계 데이터베이스 스키마
    - {릴레이션 스키마} + {무결성 제약조건(뒤에 나옴)}


    |관계데이터 모델|프로그래밍 시스템|
    |:---:|:---:|
    |릴레이션|파일|
    |튜플|레코드|
    |속성|필드|

---
## DB 키
#### 키 : 각 튜플을 구별할 수 있는 속성의 집합
- 후보 키 : 다음 두가지 성질을 만족하는 속성 집합
    1. 유일성 : 하나의 키값으로 튜플을 유일하게 `식별`
    2. 최소성 : 튜플을 식별하는데 필요한 `최소한`의 속성으로만 이루어져 있어야 함
        - ex) 주민번호(O), 학번(O), 주민번호 + 학번(X)
- 슈퍼 키 : 유일성을 만족하는 속성의 집합
- 기본 키(Primary Key)
    - 후보 키 중에서 `선정된 키`
        - 설계자가 지정
    - 모든 튜플에 기본키의 속성값은 항상 유효해야함
        - null은 허용되지 않음
- 대체 키
    - 기본 키로 선정되지 못한 후보 키
- 외래 키 : 두개의 테이블의 연결다리 역할, 한 테이블(R)의 속성 중 `다른 테이블(S)의 튜플을 식별`할 수 있는 키
    - 이때 R은 S의 부모 테이블
    - R은 참조 릴레이션, S는 피참조 릴레이션
    - 외래키는 S에 존재하는 값 이거나 null이어야 함
## 무결성 제약
1. 개체 무결성 : 기본 키 값은 null일 수 없다.
2. 참조 부결성 : 외래 키 값은 자식테이블의 기본키?후보키? 값이거나 null이다.
---
## 관계 데이터 연산
- 연산 : 시스템 입장
- 데이터 언어 : 사용자 입장
- 관계 데이터 언어
    - 관계 대수
        - 절차 언어 : how, what(원하는 정보와 `어떻게` 유도할 지도 기술한 언어)
        - 일반 집합 연산 : 합집합, 교집합, 차집합, 카디션 프로덕트
        - 순수 관계 연산 : Select, Project, Join, Division, Rename
        - 폐쇄성질 : 피연산자와 결과가 `모두 릴레이션`, `수식 중첩` 가능
    - 관계 해석
        - 비 절차 언어 : what(어떻게 보다 `무엇을` 검색하는지 만을 기술한 질의어)
        - 튜플 관계 해석 : QUEL
        - 도메인 관계 해석 : QBE

- 관계 대수 : 릴레이션을 처리하기 위한 연산의 집합
    - 일반 집합 연산자
        1. 합집합(UNION, $\cup$)
            - 두 릴레이션의 `차수`와 대응되는 `도메인`이 같아야 적용가능
            - 서로 중복되는 부분은 제외하고 두 릴레이션을 `합치는` 연산
        2. 교집합(intersect, $\cap$)
            - 두 릴레이션의 `차수`와 대응되는 `도메인`이 같아야 적용가능
            - 두 릴레이션의 `중복 부분만`을 보여주는 연산
        3. 차집합(difference, -)
            - 두 릴레이션의 `차수`와 대응되는 `도메인`이 같아야 적용가능
            - 두릴레이션의 중복부분을 연산의 앞에오는 릴레이션에서 빼는 연산

        4. 카디션 프로덕트(Catesian product,$\times$)
            - 두 릴레이션에 요소들로 구성 가능한 `모든 경우의 수`를 하나의 릴레이션으로 만들어 주는 연산자
            - 카디널리티 = 카디널리티(R) $\times$ 카디널리티(S)
            - 차수 = 차수(R) + 차수(S)
    - 순수 관계 연산자
        1. SELECT($\sigma$),수평연산
            - 릴레이션에 속한 튜플 중 `조건을 만족`하는 튜플들로 릴레이션을 만듬
            - $=,\neq,<,>,\leq,\geq,AND(\wedge),OR(\vee),NOT(ㄱ) $
            - ex) $\sigma_{학과='컴퓨터'}(학생)$ => 학생 테이블에서 학과가 컴퓨터인 튜플을 보여줌
        2. PROJECT($\Pi$),수직연산
            - `제시된 속성만` 선택하여 새로운 릴레이션을 만들고 만약 중복이 발생한다면 삭제
            - ex) $\Pi_{이름,학과}(학생)$ => 학생 테이블에서 이름과 학과 속성을 제외하고 나머지 속성을 버림, 중복된 튜플 삭제
        
    - 디비전(division)
        - 두 개의 릴레이션에서 뒤에오는 릴레이션의 속성을 제외한 `나머지 속성`을 보여줌
    - 개명 연산 : 결과 릴레이션이나 속성에 `이름을 변경`시킴
        - $\rho_{s(B_1,B_2,…,B_m)}(E)$ => 결과 릴레이션의 이름을 S로 하고  속성 이름을 B1, B2, Bm으로 함
## 조인(⋈)
- 세타조인 : R의 속성 A와 S의 속성 B가 `세타조건을 성립`하는 새로운 릴레이션을 만듬
    - 차수 = R의 차수 + S의 차수
    - ex) 학생$⋈_{학번=학번}등록$=> 학생테이블과 학번테이블에서 학번이 일치하는 새로운 테이블을 생성
- 동일(내부)조인 : 세타 조인에서 `세타가 '='`인경우
- 자연 조인 : 동일조인에서 `중복되는 속성을 제거`한 릴레이션
    - ex) $학생⋈_N등록$ 

- 세미 조인($⋉$) : S릴레이션과 `자연조인시 남게`되는 R의 튜플
    - ex) $R⋉S = R⋈_N(\Pi_Z(S))$ (여기서 Z는 R과S 둘다 가지고 있는 속성의 집합)
- 외부 조인($⟖,⟕,⟗ or ⋈^+$)
    - 조인 `조건에 해당되지 않는 튜플도` null로 설정해서 보여줌
- 외부 합집합($\cup^+$)
    - 속성값만 중복을 고려하고 나머지는 `중복을 고려하지 않고 모든 값`을 보여주는 릴레이션을 만듬(해당되는 속성값이 없을시 null값으로 채움)
- 집계 연산
    - $AVG_{성적}(등록)$ 
        - 등록 릴레이션의 성적 속성값들의 평균 계산
    - $GROUP_{학년}(학생)$ 
        - 학생 릴레이션에서 학년 값에 따라 `그룹화` 함
    - 일반적인 사용법 
        - $GROUP_AF_B(E)$
        - E릴레이션에서 A속성별 그룹에 대한 B속성에 F집계연산 적용
---
## 관계 해석(비절차적 질의, `무엇`을 검색?)
- 튜플 해석식
    - 구성요소
        - 튜플/범위 변수 t
        - 범위식 R(t) - 튜플 t가 가질 수 있는 릴레이션의 범위
        - 튜플의 속성 t.A or t[A]
        - 조건식 $t.A \theta c$ or  $t.A \theta u.B$(c는 상수)
        - 정량자
            - 전칭정량자(∀) : 모든 가능한 튜플 r에 대해 정형식 F(r)이 참이면 참
            - 존재정량자(∃) : 튜플 r 이 하나라도 존재한다면 참
    - 형식 예시
        - 학생 릴레이션에서 성적이 80 이상인 학생의 이름과 학번을 검색
        - {r.이름, r.학번 | 학생(r) and r.성적>=80}
        - |왼쪽은 |오른쪽 조건을 만족하는 튜플로부터 추출할 내용
- 도메인 해석식
    - 구성요소
        - 도메인 변수 : 속성 도메인에서 한 원소를 선택하는 변수(xSno, xSname,...)
        - 범위식 : R(x1,x2,...,xn)
        - 조건식 : x $\theta$ y or x $\theta$ c(c는 상수)
    - 형식 예시
        - 학생 릴레이션에서 성적이 80 이상인 학생의 이름과 학번을 검색
        - {이름, 학번 | 학생(이름, 학번, 성적) and 성적>=80}



 
