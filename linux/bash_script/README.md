
<!-- https://inpa.tistory.com/entry/LINUX-%EC%89%98-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D-%ED%95%B5%EC%8B%AC-%EB%AC%B8%EB%B2%95-%EC%B4%9D%EC%A0%95%EB%A6%AC -->
# 4. Bash Shell Script

---
## contents
- [0. Shell Script란?](#0-shell-script란)
- [1. 특수 문자](#1-특수-문자) <br>
- [2. 환경 설정](#2-환경-설정) <br>
  - [1. 환경 변수](#1-환경-변수)<br>
    - [bash 쉘 설정 파일](#--bash-쉘-설정-파일) <br>
    - [기본 환경변수/위치 매개변수 설정](#--기본-환경변수위치-매개변수-설정) <br>
    - [주요 환경 변수](#--주요-환경-변수-export-명령어를-통해-전체-확인-가능) <br>
    - [프롬프트 스트링(Prompt String)](#--프롬프트-스트링prompt-string) <br>
  - [2. 계정 변경](#2-계정-변경) <br>
 - [3. 특수 매개변수](#3-특수-매개변수) <br>
    - [1. 위치 매개변수](#1-위치-매개변수) <br>
    - [2. 특수 매개변수](#2-특수-매개변수) <br>
   
 - [4. 문법](#4-문법)  <br>
    - [0. 스크립트 실행 방식](#0-스크립트-실행-방식) <br>
    - [1. 첫 번째 행 작성 규칙](#1-첫-번째-행-작성-규칙---shebang) <br>
    - [2. 쉘 변수 선언](#2-쉘-변수-선언) <br>
    - [3. 산술 연산](#3-산술-연산) <br>
    - [4. 주석](#4-주석) <br>
    - [5. 조건문](#5-조건문) <br>
    - [6. 반복문](#6-반복문) <br>
       - [While문](#--While문) <br>
       - [for문](#--for문)
   
  
---

## 0. Shell Script란?
- Shell이나 command line 인터프리터에서 구동되도록 작성된 스크립트
- 인터프리터 방식: 
- hello.sh와 같이 `*.sh` 확장자를 갖는 파일이다

<br><br>

---

## 1. 특수 문자
<!--https://jdm.kr/blog/4-->

| 종류 | 설명 |
| :---: | --- |
| {} | 안의 각 문자열과 일치 |
| [] | - 안의 문자열 중 하나와 일치<br> - [1-5]는 1부터 5(1, 2, 3, 4, 5)의미 -> 영역을 나타낼 수 있다 |
| [!] 또는 [^] | []의 여집합 |
| - | 양 옆 문자에서 문자 범위 설정 |
| * | 0개 이상의 문자 대체 |
| ? | 1개의 문자 대체 |
| ~ | 유저의 홈 디렉토리<br> (/home/<userid>) |
| . | 현재 디렉토리 |
| .. | 상위 디렉토리 |
| # | 주석 |
| \ | 특수문자 바로 앞에 사용되며, 특수문자의 효과를 없앤다 |
| > | redirection<br>- 출력의 방향을 바꾼다 <br> - 기호 뒤에 파일명이 온다면, 파일로 명령의 결과를 저장 <br> - 이때 존재하는 파일이라면 파일을 덮어쓴다 <br> - 존재하지 않는 파일이라면 파일을 생성하고 입력 |
| >> | redirection<br>- 출력의 방향을 바꾼다<br> - 기호 뒤에 파일명이 온다면, 파일로 명령의 결과를 저장<br> - 이때 존재하는 파일이라면 파일의 마지막 줄 이후로 내용 추가<br> - 존재하지 않는 파일이라면 파일을 생성하고 입력 |
| < | redirection<br>- 표준 입력의 방향을 바꾼다 <br>- 기호 뒤에 파일명이 오면 그 파일의 내용을 표준 입력으로 받아들임 |
| & | 백그라운드 작업 |
| ; | - 쉘 명령 구분자 <br> - 연결된 명령을 왼쪽부터 차례로 실행 |
| \| | - 파이프 <br> - 파이프 왼쪽의 실행 결과를 오른쪽 명령의 입력으로 전달<br> |
| ` | -  문자열 사이에 `로 감싼 문자열이 있다면 그것은 **명령어**로 해석된다<br> - 명령어의 결과가 출력된다 |
| '또는 " | - 문자를 감싸서 문자열로 만든다<br> - 작은 따옴표는 모든 특수 기호를 일반 문자로 간주하여 처리<br> - 큰 따옴표는 <kbd>$, `, \</kbd>를 제외한 모든 특수 기호를 일반 문자로 간주 |

```console
$ ls test*
#이름이 test로 시작하는 모든 파일/디렉토리 출력

$ ls -al [!a-C]*
#파일명이 a부터 C 까지의 중 하나의 알파벳으로 시작하지 않는 모든 파일 출력

$ cat hello.txt | more
#cat hello.txt 명령의 결과를 more로 전달
#-> hello.txt의 내용을 화면 단위로 출력

$ echo '$SHELL' 
#화면에 $SHELL 이라는 문자열이 출력

$ echo "$SHELL"
#화면에 쉘 환경 변수인 SHELL의 값(현재 휄의 종류)이 출력된다

$ echo "Today is `date`"
#date가 `(백 쿼터)로 감싸 있으므로 명령어로 인식된다 -> 날짜 정보 출력
```
```console
$ ./test.sh >> /dev/null 2>&1 
#표준 출력이 필요 없다(2는 에러, 1은 표준 출력) 
#2>&1: 표준 에러 출력을 표준출력장치로 저장된 /dev/null로 리다이렉트한다
#/dev/null은 항상 비어있는 파일
```
- **2>&1** 동작 이해: <br>
  - 명령어가 실패하면 err내용이 저장, 명령어가 성공하면 성공한 표준 출력 결과가 저장되도록 한 명령어를 함축한 것 <br>
  - 표준 에러를 표준 출력(&1)으로 지정한다<br>
  - 표준 출력을 > 명령을 통해 파일로 재지정했다면 이 파일에 표준 에러가 담긴다 <br>

- **/dev/null** 이해: <br>
  - 화면에 표시하지 않겠다는 의미(이곳으로 전송된 데이터는 버려진다) <br>
<br><br>

---
 
## 2. 환경 설정
### 1. 환경 변수
 
- **echo $환경변수** 를 통해 환경 변수 값 확인 가능
- 환경 변수는 세션에만 유효하다(로그아웃 또는 재부팅 시 사라진다) <br>
- 환경 변수를 영구적으로 적용하기 위해서는 [설정 파일](#--bash-쉘-설정-파일)에 설정한다 <br>
 - 특정 사용자에게만 환경변수를 영구적으로 적용하고 싶다면 **~/.bashrc**파일 수정 <br>
 - 추가로, **set** 을 통해 **위치 매개변수** 설정 가능 <br>
 - 추가로, set은[vi 편집기의 ex모드에서](https://github.com/1006lem/BashShellScript/blob/main/linux/vim/README.md/#9-추가-ex-모드-명령어)에서 사용되기도 했다.

<br>
 
#### - bash 쉘 설정 파일
 -**/etc/bash.bashrc** 파일은 사용자가 로컬 터미널 세션을 열 때마다 실행하는 파일
 
 | 파일명 | 설명 |
 | :---: | --- |
 | .bash_profile | - 사용자 로그인 시 가장 먼저 호출된다<br> - `.bashrc`파일을 호출한다 <br> - 대화형 **로그인** 셸로 호출될 때 읽고 실행 <br> - 처음 리눅스를 부팅하고 터미널을 켜서 shell로 접속할 때 실행 |
 | .barhrc | - 사용자 로그인 시 두번째로 호출된다<br> - `/etc/bashrc`파일을 호출한다 <br> - 대화형 **비로그인** 셸에 대해 실행 <br> - 이미 로그인한 상태에서 새 셸을 열 때 실행(`su`와 같은 경우) |
 | /etc/barhrc | - 사용자 로그인 시 마지막으로 호출된다 <br> |
 
 
 <br>
 
 #### - 기본 환경변수/위치 매개변수 설정
 
| 명령어 | 설명 |
| :---: | --- |
| env | **전역 변수** 설정, 조회 |
| set | - **사용자 환경 변수** 설정, 조회<br>- **쉘 환경 설정** |
| unset | **사용자 환경 변수** 해제 |
| export 환경변수명=환경변수값 | 사용자 환경 변수를 전역 변수로 설정 |
| export | 전체 환경 변수  |

```console
$ export JAVA_HOME=/usr/hava/jdk1.6.0
#JAVA_HOME 환경변수에 jdk경로를 등록한다

$ env | grep 환경변수
#환경변수 확인

$ unset 환경변수
#환경변수 해제
```
 
```console
$ vi /etc/bash.bashrc 
#vi 에디터를 이용해 /etc/bash.bashrc파일 접근
 
$ export JAVA_HOME=/usr/hava/jdk1.6.0
#파일의 맨 마지막 라인에 환경 변수 등록
```
 
 <br>
 
 #### - 주요 환경 변수 (**export** 명령어를 통해 전체 확인 가능)
 
| 종류 | 설명 |
| :---: | --- |
| HOME | 사용자 홈 디렉토리 |
| PATH | 실행 파일을 찾을 경로 |
| LANG | 프로그램 사용 시 기본으로 지원되는 언어 |
| PWD | 사용자의 현재 작업중인 디렉토리 |
| SHELL | 로그인하여 사용하는 쉘 |
| BASH | Bash 실행 파일 경로 |
| PPID | 부모 프로세스의 PID |
| UID | 사용자 UID |
| USER | 사용자 이름 |
| GROUPS | 사용자 그룹 출력(`/etc/passwd`값 출력) |
| LANG | 프로그램 사용 시 기본으로 지원되는 언어 |
| EDITOR | 기본 편집기 이름 |

```console
$ export
#환경 변수 목록 확인
 
$ echo $HOME 
#home디렉토리의 경로 표시
```

<br>
 
 
#### - 프롬프트 스트링(Prompt String)
- 프롬프트 스트링은 사용자의 입력을 대기할 때 나타나는 문자이다
- 명령 프롬프트 변수로, **환경 변수** 에 속한다
- 기본적으로 보이는 `[user@home]$` 꼴의 프롬프트가 PS1 프롬프트 스트링을 나타낸다
- `echo $PS1` 명령어를 통해 확인 가능
- 프롬프트 스트링을 변경해 대기 문자열 **내용** , **색상** 을 바꿀 수 있다
- 쉘 창을 닫는다면 설정이 되돌아간다
- 설정을 유지하고 싶다면 `.bashrc`파일에 PS1 환경변수를 등록한다

| 프롬프트 스트링 | 설명 |
| :---: | --- |
| PS1 | - 기본 프롬프트 스트링 <br> - 기본값 `[\u@\h\ \W]\$` <br> - `[user@home]$`와 같이 나오는 형태의 명령 프롬프트 |
| PS2 | - 긴 문자 입력을 위해 나타나는 문자열<br> - 기본값 `>` |
| PS3 | - selet 옵션을 처리할 때 나타나는 문자열  |
| PS4 | - 실행을 디버깅할 때 출력되는 문자열<br> - 기본값 '+'  |

PS1을 설정할 때 **특수 기호(이스케이프 문자)** 를 이용해 설정할 수 있다

**특수 기호(이스케이프 문자)**

| 특수 기호 | 설명 |  
| :---: | --- |
| \u | 사용자명 | 
| \h | 호스트명 | 
| \W | 현재 디렉토리명 |
| \d | 현재 날짜 |
| \n | 개행 문자 |
| \u | 현재 사용자 이름 |

- PS1의 기본값은 \[\u@\h\ \W]\$ 이므로 [현재사용자이름@호스트명 현재디렉토리명]$ 을 의미한다

**색상 비출력 문자 시퀀스**
- 비출력 문자의 시작을 나타내는 `\[`를 작성하고 시퀀스를 쓰며 `\]`로 닫아준다

| 시퀀스 | 대상 | 색상 |  
| :---: | :---: | --- |
| \033[0;30m | 문자열 | 검정 | 
| \033[0;31m | 문자열 | 빨강 | 
| \033[0;33m | 문자열 | 노랑 | 
| \033[0;34m | 문자열 | 파랑 |
| \033[0m | 문자열 | **제거** |
| \033[0;40m | 바탕색 | 검정 |
| \033[0;41m | 바탕색 | 빨강 |
| \033[0;43m | 바탕색 | 노랑 |
| \033[0;44m | 바탕색 | 파랑 |
| \033[0m | 바탕색 | **제거** |

```console
$ PS1="\[\033[0;34m\]\u-\d@\w$"
#색상은 파란색으로, 형식은 사용자명-현재시간$ 꼴로 설정한다
```


<br><br>

 
### 2. 계정 변경
#### sudo, su 명령어
- 현제 접속한 계정과 다른 계정에서 작업을 처리할 때 사용

| 명령어 | 이름 | 설명 |
| :---: | :---: | --- |
| su | substitute user | - root 계정으로 변경<br> - 암호 필요
| su 계정명 | substitute user | - 다른 계정으로 변경<br> - 암호 필요
| sudo | substitute user do | - root 계정으로 명령어만 실행
| sudo -u 계정명| substitute user do | - 다른 계정으로 명령어만 실행

```console
$ sudo apt-get install git
#git설치
```

<br><br>

---

## 3. 특수 매개변수
### 1. 위치 매개변수

 - **set** 명령어를 통해 위치 매개변수를 다룰 수 있다
 
| 종류 | 설명 |
| :---: | --- |
| $0 | 쉘 스크립트 이름 |
| $1 부터 $10 | - 1부터 10 번째 매개변수<br> - 10번째부터는 ${10}과 같이 감싸준다 |
| $# | 위치 매개변수의 총 개수 |
| $* | 전체 인자 값 |
| $@ | 전체 인자값|
| "$*" | "$1 $2 $3" 꼴로 평가 |
| "$@" | "$1""$2""$3" 꼴로 평가 |

 ```console
 $ ./test a b
 #다음과 같이 실행과 같이 넘겨주는 argument(a, b)를 위치 매개변수로 인식
 #$1에는 a가, $2에는 b가 저장
 #실행하는 파일인 test에서 이 값을 사용할 수 있다 
```

<br>

### 2. 특수 매개변수

| 종류 | 설명 |
| :---: | --- |
| $! | 백그라운드로 실행된 명령의 pid |
| $$ | 셸 스크립트의 pid |
| $? | 명령을 정상적으로 실행했다면 **0** 반환, 그렇지 않다면 그 이외의 값 반환 |
| $_ | 지난 명령의 마지막 인자로 설정된 값 |
| $- | 현재 쉘이 호출될 때 사용한 옵션 (플래그 정보 반환) |

- 주요 플래그 정보

| 종류 | 이름 | 설명 |
| :---: | :---| --- |
| h | hash all | PATH를 쿼리해 알아낸 명령의 주소 기억 |
| i | interactive | 사용자와 interacting(input을 집어넣고 output반환) |
| m | monitor | 포그라운드/백그라운에서 job 모니터링 |
| B | brace expand |  괄호 확장 |
| H | history expand |  **!숫자** 를 통해 명령어를 history에 기억 |

```console
$ echo $-
#실행 결과: himBHs(플래그 정보 참고)
```

<br><br>

---

## 4. 문법

### 0. 스크립트 실행 방식
- 이 세 가지 방식을 이용해 bash 쉘 환경에서 파일을 실행할 수 있다

1. sh 파일명
2. bash 파일명
3. ./파일명

<br>

### 1. 첫 번째 행 작성 규칙 - Shebang
```console
#! /usr/bin/bash
```
- 첫번째 줄에 작성한 내용은 쉘 스크립트가 실행될 때 어떤 쉘로 스크립트를 실행할지 정의한다
- 여러 가지 쉘 중에서 bash로 실행하겠다는 선언을 첫줄에 작성한다.
- 이러한 쉘 선언문을 **Shebang** 이라고 한다.

```console
#쉘 스크립트 작성(test.sh)
#! /bin/bash
echo "Hello World!"
exit 0
 
#스크립트 실행
$ cat test.sh
```

```console
vi script.sh # vi편집기를 이용해 script 작성
$ bash script.sh # script 실행
```

<br>

### 2. 쉘 변수 선언
- 로컬 변수, 전역 변수, 환경 변수, 예약 변수, 매개 변수 등 존재
- 대, 소문자 구별
- 변수명은 숫자로 시작 불가
- 값을 사용할 때에는 **$** 을 이용 (`${data}`)
- `=` 양옆으로 **공백 허용 x** (`data="data"`)
- 기본적으로 변수는 **전역 변수**
- **지역 변수** 는 변수명 앞에 `local`이 붙어 있다
- 기본적으로 변수 type을 지정하지 않는다

```
#!/usr/bin/bash

name="kim"
# 대입 문자 = 양옆으로 공백 x

echo $name
echo "my name is ${name}"
#name의 값을 $를 이용해 가져온다
#{}는 문자열 안에서 변수 값을 가져와야 하므로 사용
```

```
name="kim"
function name_change(){
　local name="my name"
　echo ${name}      #local name인 "my name" 출력
}
name_change 
#함수 호출

echo ${name}
#전역 변수인 "kim" 출력

```

- 변수 타입 지정
 
 | 옵션 | 설명 |
 | :---: | --- |
 | -r | - 읽기 전용 (c언어의 **const** 형 한정어와 비슷) <br> - 변수 값을 바꾸려 하면 에러 메시지가 출력된다| 
 | -i 변수명 | 명령어 이후에 나오는 모든 **변수명** 을 가진 변수를 **정수 취급** |
 | -a | 배열 취급 |
 | -x | (export) 스크립트 외부 환경에서도 해당 변수를 사용 가능하도록 설정 |
 
 ```
 declare -r variable1 
 #읽기전용(-r) 변수 선언
 #c언어의 const와 비슷
 ```
 
 ```
 declare -i year
 year="hello"
 echo $((year+1))    # 1 출력
 
 year=2022
 echo $((year+1))   # 2023 출력
 
 year="2022"     
 echo $((year+1))   # 2023 출력    # 문자열 2022를 정수로 취급
 
 ```
 <br>
 
 ### 3. 산술 연산
 - 산술 연산자에는 `expr`, `let`, `$(())` 세 가지가 존재한다
 
 | 연산자 | 설명 |
 | :---: | --- |
 | expr | - `로 감싸서 사용<br> - 피연산자와 연산자 사이에 공백 필요<br> - (**주의**) 특수 문자 사용 시 excape 문자(\\)로 처리해야 한다 |
 | let | 수식의 결과를 저장할 변수 앞에 **let** 연산자를 넣어 연산 결과 저장 |
 | $(()) | - 괄호 안에서 연산(!, ~, **, <<, >>, &) 가능 |

```
#!/bin/bash

number1=1
number1=2

plus=`expr $number1 + $number2`
#3

let div=number1 / number2
#0

echo $((number1 % number2))
#1

mul=`expr $number1 \* $number2`
#2

```

<br>

### 4. 주석
- `#`로 한 줄 주석
- 블록 주석은 `: << "END"`로 주석을 시작하고 `END`로 주석을 닫는다
 
 ```
 #!/usr/bin/bash
 # 한 줄 주석
 
 echo "hi"
 
 : << "END"    #주석 시작
 plus=$((number1 + number2))
 echo $(plus)
 END           #주석 끝
 
 echo "Hello"
 ```
 - _프로그램 실행 시 hi와 hello만 출력된다_
 
 <br>
 
### 5. 조건문

#### - if문
　- 중괄호를 작성하지 않으므로 if문의 끝을 알리기 위해 **fi** 사용 <br>
　- if문의 조건부 작성 시 대괄호를 사용하고, <br> 
　　if와 `[`, `[` 와 조건식, 조건식과 `]` 사이에는 **공백**이 존재해야 한다

- if문에서 많이 사용되는 연산자

| 연산자 | true반환조건 | 
| :---: | --- |
| -eq | - 두 값이 같은 경우 |
| -ne | - 두 값이 다른 경우 |
| -lt | - 왼쪽 값이 작은 경우 |
| -le | - 왼쪽 값이 작거나 같은 경우 |
| -gt | - 왼쪽 값이 큰 경우 |
| -ge | - 왼쪽 값이 크거나 같은 경우 |
| -z | - 문자열 길이가 0인 경우 |
| -n | - 문자열 길이가 0이 아닌 경우 |
| == | - 문자열이 동일한 경우 |
| < | - 문자열을 사전순으로 정렬 시 왼쪽이 선행되는 경우 |
| > | - 문자열을 사전순으로 정렬 시 오른쪽쪽이 선행되는 경우 |
| && | - 논리식 AND |
| \|\| | - 논리식 OR |
| !\| | - 논리식 NOT |

 - 예제
 
```
#!/usr/bin/bash

num=0

#eq 연산자를 이용해 같은지 확인
if [ $num -eq 0]; then
　echo "number is 0"
 else 
　echo "number is not 0"
fi
```

<br>

### 6. 반복문

#### - While문

- while문 형식

```
while [조건]
do 
  명령
done
```
- **무한 루프**의 경우, 조건부는 `while :` 로 표시
- **continue**, **break**문 그대로 사용 가능
- 예제

```
#!/bin/bash

num = 0
while [ $num -le 2] #숫자가 2보다 작은 경우 반복
do
 echo "${num}" 
 ((num++))
done
```
<br>

#### - for문

- for문 형식
  
```
for [배열 아이템] in [배열,리스트,...]
do
 명령
 ${배열 아이템}
done
```
- **무한 반복**은 `for(( ; ; ))` 와 같이 사용 
- **continue, break**문 사용 가능
- 예제 1

```
#!/bin/bash

for anyInt in {00..20}
#{00...20}은 00, 01, 02, 03, ... 20을 의미 (대체하여 사용하여도 무관)
do
 echo {anyInt}
done

#출력
00
01
02
(생략)
20
```
* 주의: for문의 범위로 `{시작..종료}` 형식을 갖춰, 순차적으로 증가하며 반복시킨다
 
 <br>
 
- 예제 2
```
#!/bin/bash

arr = (10 40 32)
for anyInt in "${arr[@]}"
do
 echo {anyInt}
done

#출력
10
40
32

```
* 주의: `arr[@]` 를 통해 arr배열의 모든 원소를 가져온다

 <br>
 
- 예제 3

 ```
#!/bin/bash

arr = "A B C"
for anyInt in $arr
do
 echo $anyInt
done

#출력
A
B
C
```
<br>
<br>

- 예제 4

 ```
#!/bin/bash

for ((i=0; i<3; i++))
do
 echo $i
done

#출력
1
2
```
* 주의: 이중 괄호를 통해 C언어 스타일의 반복문 문법 사용 가능
 

 
 
 
 <!--
  #### set 명령어 주요 옵션
- **set --help** 명령어를 통해 전체 옵션 확인 가능
 
| 옵션 | 설명 |
| :---: | --- |
| -a | 값이 할당된 변수 export |
| **-e** | **오류** 가 발생하면 스크립트 종료 |
| -x | 수행하는 명령어 출력 후 실행 |
| -m | 작업이 완료되면 메시지 효시 |
| -o | 옵션 설정 |
| +옵션 | 옵션 끄기 |
 
 
- 예시
 - 기존 a.sh파일을 작성했다고 하자.
``` 
 # a.sh
 set -e
 echo hi
 cat blahblah
```
 
```console
 $ cat a.sh #a.sh파일을 실행한다(cat을 통해 파일을 실행할 수 있다. 자세한 내용은 아래에*****)
 #이때 echo hi는 정상 명령어이므로 수행된다
 #cat blahblah명령어를 실행하는데, 이때 blahblah파일이 없으므로 **오류가 발생** 한다
 #set -e 명령을 주었으므로 오류가 발생해도 
 
```

<!-- 배열 추가~~~~~~~~ -->
 <!--
 > set 명령어 매개변수
- set /p variable=promptString
 
| 매개변수 | 설명 |
| :---: | --- |
| /p | 사용자가 입력한 입력 줄을 variable로 설정| 
-->

<!--
 
 
1. Bash 쉘 빌트인 명령성
1. 파이프, 리다이렉션
2. env, set, sudo, s, ecoirt, ps

2. 쉘스크립트 작성
문자열
-->
